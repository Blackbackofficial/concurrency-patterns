## Пример 2:

Паттерн "Fan-Out" с отменой контекста, позволяющий распределить данные из одного исходного канала на несколько рабочих горутин и гармонично завершить процесс распределения. Вот как это работает:

1. Функция `FanOutWithCancel` принимает исходный канал (`src`), количество рабочих горутин (`n`) и контекст (`ctx`) для отмены.

2. Она создает массив целевых каналов (`dests`) и запускает `n` горутин, каждая из которых имеет свой собственный целевой канал. Эти целевые каналы используются для распределения данных из исходного канала среди рабочих.

3. Внутри каждой рабочей горутины есть цикл `for`, который читает данные из исходного канала и пересылает их в соответствующий целевой канал. Рабочие горутины также ожидают сигналов от контекста для гармоничного выхода из цикла и завершения.

4. Функция `main` начинается с создания исходного канала с использованием функции `source`, которая заполняет исходный канал целыми числами от 1 до 10.

5. Затем вызывается функция `FanOutWithCancel` с исходным каналом, желаемым количеством рабочих горутин (в данном случае 5) и контекстом для отмены.

6. Для обеспечения ожидания завершения работы всех рабочих горутин в функции `main` используется `sync.WaitGroup` (`wg`).

7. Для каждого целевого канала, созданного функцией `FanOutWithCancel`, запускается рабочая горутина. Эти рабочие горутины читают данные из соответствующих целевых каналов и выводят их.

8. Чтобы имитировать некоторую работу, функция `main` вводит задержку в 1 секунду с использованием `time.Sleep(1 * time.Second`.

9. После имитации работы контекст отменяется с помощью `cancel()`, что вызывает гармоничное завершение рабочих горутин.

10. Функция `main` ожидает завершения всех рабочих горутин с использованием `wg.Wait()`. После завершения всех рабочих и отмены контекста программа завершает работу гармонично.

В заключение, паттерн "Fan-Out" с отменой контекста эффективно распределяет данные из одного источника на несколько рабочих горутин для параллельной обработки и предоставляет средство для гармоничного завершения с использованием отмены контекста.