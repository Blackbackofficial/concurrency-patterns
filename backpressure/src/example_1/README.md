## Пример 1:

Этот код использует паттерн "backpressure" с использованием структуры `PressureGauge`. Вот как это работает:

1. `PressureGauge` - это структура, представляющая механизм управления "backpressure". Она содержит канал `ch`, у которого ограниченная пропускная способность, указываемая при создании экземпляра этой структуры.

2. Функция `New(limit int)` - это функция, которая инициализирует `PressureGauge`. Она заполняет канал `ch` с указанным лимитом, представляющим максимальное количество одновременных задач.

3. Метод `Do(fn func()) error` - это метод `PressureGauge`, который используется для выполнения задачи с учетом "backpressure". Он пытается извлечь значение из канала `ch`. Если есть доступная пропускная способность, он выполняет задачу (переданную как функцию `fn`) и затем возвращает пропускную способность, добавляя значение обратно в канал `ch`. Если пропускной способности нет, он возвращает ошибку "out of capacity" (недостаток пропускной способности).

4. В функции `runServer(pg *PressureGauge)` используется `PressureGauge` для контроля числа одновременных запросов к серверу. Если есть доступная пропускная способность (которая в этом случае ограничена 3), сервер выполняет "дорогостоящую операцию" (функцию `expensiveOperation`) и отправляет ответ. Если нет доступной пропускной способности, сервер возвращает статус HTTP "429 Too Many Requests" (слишком много запросов).

5. В функции `main()` запускаются несколько горутин, которые выполняют HTTP-запросы к серверу. С использованием `PressureGauge` их количество ограничено тремя одновременными запросами, что демонстрирует использование паттерна "backpressure" для контроля потока данных и предотвращения перегрузки сервера.

Этот код иллюстрирует использование "backpressure" для управления нагрузкой на сервер и эффективного управления ресурсами, предотвращая перегрузку системы.